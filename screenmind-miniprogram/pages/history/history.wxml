<!--pages/history/history.wxml-->
<view class="container">
  <!-- 头部统计 -->
  <view class="stats-section">
    <view class="stats-card card">
      <view class="card-body">
        <view class="stats-grid">
          <view class="stat-item">
            <view class="stat-number">{{totalCount}}</view>
            <view class="stat-label">总记录</view>
          </view>
          <view class="stat-item">
            <view class="stat-number">{{todayCount}}</view>
            <view class="stat-label">今日</view>
          </view>
          <view class="stat-item">
            <view class="stat-number">{{weekCount}}</view>
            <view class="stat-label">本周</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 筛选器 -->
  <view class="filter-section">
    <view class="filter-card card">
      <view class="card-body">
        <view class="filter-tabs">
          <view 
            class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}"
            bindtap="handleFilterChange"
            data-filter="all"
          >
            全部
          </view>
          <view 
            class="filter-tab {{currentFilter === 'today' ? 'active' : ''}}"
            bindtap="handleFilterChange"
            data-filter="today"
          >
            今天
          </view>
          <view 
            class="filter-tab {{currentFilter === 'week' ? 'active' : ''}}"
            bindtap="handleFilterChange"
            data-filter="week"
          >
            本周
          </view>
          <view 
            class="filter-tab {{currentFilter === 'month' ? 'active' : ''}}"
            bindtap="handleFilterChange"
            data-filter="month"
          >
            本月
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 历史记录列表 -->
  <view class="history-section">
    <!-- 加载状态 -->
    <view class="loading-container" wx:if="{{loading}}">
      <view class="loading"></view>
      <text class="loading-text">加载中...</text>
    </view>

    <!-- 空状态 -->
    <view class="empty-state" wx:elif="{{historyList.length === 0}}">
      <view class="empty-icon">📝</view>
      <view class="empty-title">暂无记录</view>
      <view class="empty-desc">还没有分析记录，快去使用浏览器扩展吧！</view>
    </view>

    <!-- 记录列表 -->
    <view class="history-list" wx:else>
      <view 
        class="history-item card"
        wx:for="{{historyList}}"
        wx:key="id"
        bindtap="handleItemClick"
        data-item="{{item}}"
      >
        <view class="card-header">
          <view class="d-flex align-center justify-between">
            <view class="item-type">
              <text class="badge badge-{{item.type === 'math' ? 'primary' : item.type === 'text' ? 'success' : 'warning'}}">
                {{item.typeText}}
              </text>
            </view>
            <view class="item-time">
              <text class="text-muted">{{item.timeText}}</text>
            </view>
          </view>
        </view>
        
        <view class="card-body">
          <view class="item-question">
            <view class="question-label">🤔 题目:</view>
            <view class="question-content">{{item.question}}</view>
          </view>
          
          <view class="item-answer">
            <view class="answer-label">✅ 答案:</view>
            <view class="answer-content">{{item.answer}}</view>
          </view>
        </view>

        <view class="card-footer">
          <view class="d-flex align-center justify-between">
            <view class="item-confidence" wx:if="{{item.confidence}}">
              <text class="confidence-label">置信度:</text>
              <text class="confidence-value {{item.confidence >= 0.8 ? 'high' : item.confidence >= 0.6 ? 'medium' : 'low'}}">
                {{item.confidence}}%
              </text>
            </view>
            <view class="item-actions">
              <button 
                class="btn btn-small btn-outline"
                bindtap="handleShare"
                data-item="{{item}}"
                catchtap="true"
              >
                分享
              </button>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 加载更多 -->
    <view class="load-more" wx:if="{{hasMore && !loading}}">
      <button class="btn btn-outline btn-block" bindtap="handleLoadMore">
        加载更多
      </button>
    </view>

    <!-- 没有更多 -->
    <view class="no-more" wx:if="{{!hasMore && historyList.length > 0}}">
      <text class="text-muted">没有更多记录了</text>
    </view>
  </view>
</view>