<!--pages/detail/detail.wxml-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- è¯¦æƒ…å†…å®¹ -->
  <view class="detail-content" wx:else>
    <!-- å¤´éƒ¨ä¿¡æ¯ -->
    <view class="header-section">
      <view class="header-card card">
        <view class="card-body">
          <view class="header-info">
            <view class="info-row">
              <view class="info-label">ç±»å‹:</view>
              <view class="info-value">
                <text class="badge badge-{{detail.type === 'math' ? 'primary' : detail.type === 'text' ? 'success' : 'warning'}}">
                  {{detail.typeText}}
                </text>
              </view>
            </view>
            <view class="info-row">
              <view class="info-label">æ—¶é—´:</view>
              <view class="info-value">{{detail.timeText}}</view>
            </view>
            <view class="info-row" wx:if="{{detail.confidence}}">
              <view class="info-label">ç½®ä¿¡åº¦:</view>
              <view class="info-value">
                <text class="confidence-value {{detail.confidence >= 80 ? 'high' : detail.confidence >= 60 ? 'medium' : 'low'}}">
                  {{detail.confidence}}%
                </text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- åŸå§‹å›¾ç‰‡ -->
    <view class="image-section" wx:if="{{detail.imageUrl}}">
      <view class="image-card card">
        <view class="card-header">
          <text>ğŸ“· åŸå§‹æˆªå›¾</text>
        </view>
        <view class="card-body">
          <view class="image-container">
            <image 
              class="detail-image" 
              src="{{detail.imageUrl}}" 
              mode="widthFix"
              bindtap="handlePreviewImage"
              show-menu-by-longpress="{{true}}"
            />
          </view>
        </view>
      </view>
    </view>

    <!-- é¢˜ç›®å†…å®¹ -->
    <view class="question-section">
      <view class="question-card card">
        <view class="card-header">
          <view class="d-flex align-center justify-between">
            <text>ğŸ¤” è¯†åˆ«çš„é¢˜ç›®</text>
            <button 
              class="btn btn-small btn-outline"
              bindtap="handleCopyQuestion"
            >
              å¤åˆ¶
            </button>
          </view>
        </view>
        <view class="card-body">
          <view class="question-content">
            <text class="question-text" selectable="{{true}}">{{detail.question}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç­”æ¡ˆå†…å®¹ -->
    <view class="answer-section">
      <view class="answer-card card">
        <view class="card-header">
          <view class="d-flex align-center justify-between">
            <text>âœ… åˆ†æç­”æ¡ˆ</text>
            <button 
              class="btn btn-small btn-outline"
              bindtap="handleCopyAnswer"
            >
              å¤åˆ¶
            </button>
          </view>
        </view>
        <view class="card-body">
          <view class="answer-content">
            <text class="answer-text" selectable="{{true}}">{{detail.answer}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- è§£é¢˜æ­¥éª¤ -->
    <view class="steps-section" wx:if="{{detail.steps && detail.steps.length > 0}}">
      <view class="steps-card card">
        <view class="card-header">
          <text>ğŸ“ è§£é¢˜æ­¥éª¤</text>
        </view>
        <view class="card-body">
          <view class="steps-content">
            <view 
              class="step-item"
              wx:for="{{detail.steps}}"
              wx:key="index"
            >
              <view class="step-number">{{index + 1}}</view>
              <view class="step-text">{{item}}</view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç›¸å…³çŸ¥è¯†ç‚¹ -->
    <view class="knowledge-section" wx:if="{{detail.knowledge && detail.knowledge.length > 0}}">
      <view class="knowledge-card card">
        <view class="card-header">
          <text>ğŸ’¡ ç›¸å…³çŸ¥è¯†ç‚¹</text>
        </view>
        <view class="card-body">
          <view class="knowledge-content">
            <view 
              class="knowledge-tag"
              wx:for="{{detail.knowledge}}"
              wx:key="index"
            >
              {{item}}
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="actions-section">
      <view class="actions-card card">
        <view class="card-body">
          <view class="action-buttons">
            <button 
              class="btn btn-primary btn-block mb-2"
              bindtap="handleShareAll"
            >
              ğŸ“¤ åˆ†äº«å®Œæ•´å†…å®¹
            </button>
            <button 
              class="btn btn-secondary btn-block mb-2"
              bindtap="handleSaveImage"
              wx:if="{{detail.imageUrl}}"
            >
              ğŸ’¾ ä¿å­˜å›¾ç‰‡
            </button>
            <button 
              class="btn btn-outline btn-block"
              bindtap="handleReAnalyze"
            >
              ğŸ”„ é‡æ–°åˆ†æ
            </button>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>